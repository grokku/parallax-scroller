const e=new class{config;constructor(e){this.config=e}isActive(){return this.config.active}setIsActive(e){this.config={...this.config,active:e}}getFullViewHeight(){return this.config.fullViewHeight}setFullViewHeight(e){this.config={...this.config,fullViewHeight:e}}getMaxPercentage(){return this.config.maxPercentage}setMaxPercentage(e){this.config={...this.config,maxPercentage:e}}}({active:!1,fullViewHeight:0,maxPercentage:0});let t=null;const n=e=>{if(e){if("function"!=typeof e)throw new Error("Listener must be a function");t=e}},r=e=>!!t&&(t(e),!0),o=/\s*(@?[\w\-\[\]]+)\s*:\s*(.+?)\s*(?:;|$)/gi,s=/[-+]?\d*\.?\d+(e[-+]?\d+)?/gi;var l;!function(e){e.init="init",e.scrollForward="scrollForward",e.scrollBackward="scrollBackward"}(l||(l={}));const i=/\{\?\}/,a=(e,t)=>t.reduce(((e,t)=>e.replace(i,t.toString())),e),c={},u=(e,t,n)=>{if("number"!=typeof n)throw new Error(`Scroll percentage must be an integer, got "${n}" instead`);e.forEach((e=>{const{rule:r,template:o,values:l}=(e=>{const[t,n]=Object.entries(e)[0]||[];if(!t||!n)return{rule:null,template:"",values:[]};const r=[];return{rule:t,template:n.replace(s,(e=>(r.push(parseFloat(e)),"{?}"))).trim(),values:r}})(e);if(!r)return;const i={constant:n,template:o,values:l};t.styles[r]=(t.styles[r]||[]).concat(i)}))},m=(e,t,{from:n,to:r})=>{const o=n.constant*window.innerHeight,s=c[e.name]??-1;if(t>=o&&s<o)return g(e.name,n.constant,l.scrollForward),!0;if(t<=o&&s>o)return g(e.name,n.constant,l.scrollBackward),!0;if(r){const n=r.constant*window.innerHeight;if(t>=n&&s<n)return g(e.name,r.constant,l.scrollForward),!0;if(t<=n&&s>n)return g(e.name,r.constant,l.scrollBackward),!0}return!1},g=(e,t,n)=>{r({checkpoint:100*t,name:e,stage:n})},f=(e,t,n,{from:r,to:o})=>{const s=r.constant*window.innerHeight,l=o?o.constant*window.innerHeight:null;return!(t<s&&c[e.name]<s||null!==l&&t>=l&&c[e.name]>=l)&&((e,t,n,{from:r,to:o})=>{const s=r.constant*window.innerHeight;if(o){const u=o.constant*window.innerHeight;if(r.values.length&&o.values.length){if(r.values.length!==o.values.length)throw new Error("Styles between keyframes must match");const m=((e,t,n)=>e>=n?1:t<=e&&e<=n?(e-t)/(n-t):0)(t,s,u),g=(l=r.values,i=o?.values,c=m,l.map(((e,t)=>((e,t,n)=>e+(t-e)*n)(e,i[t],c))));return e.node.style.setProperty(n,a(o.template,g)),t>=s&&t<=u}if(t>=u)return e.node.style.setProperty(n,o.template),!0;if(t>=s)return e.node.style.setProperty(n,r.template),!0}else if(t>=s)return r.values.length?e.node.style.setProperty(n,a(r.template,r.values)):e.node.style.setProperty(n,r.template),!0;var l,i,c;return!1})(e,t,n,{from:r,to:o})},h=/^data-(\d*)p$/,d=(t,n)=>{const r=t.name.match(h);if(!r)return!1;const s=parseInt(r[1],10)/100,l=(e=>{const t=[];let n;for(;n=o.exec(e);){const[,e,r]=n;t.push({[e]:r})}return o.lastIndex=0,t})(t.value);return s>e.getMaxPercentage()&&e.setMaxPercentage(s),u(l,n,s),!0},w=e=>{const t=e.getAttribute("data-scroll");if(!e.attributes||!t)return;const n={name:t,node:e,styles:{}};r({name:t,stage:l.init});const o=e.attributes;for(let e=0,t=o.length;e<t;e++)d(o[e],n);return(e=>{Object.keys(e.styles).forEach((t=>{e.styles[t].sort(((e,t)=>e.constant-t.constant))}))})(n),(e=>{Object.entries(e.styles).forEach((([t,n])=>{if(0===n[0].constant){const r=n[0].values.length?a(n[0].template,n[0].values):n[0].template;e.node.style.setProperty(t,r)}}))})(n),n},y=()=>{const t=document.querySelectorAll("[data-scroll]"),n=Array.from(t).reduce(((e,t)=>{const n=w(t);return n&&e.push(n),e}),[]),r=e.getMaxPercentage()*window.innerHeight;return e.setIsActive(!0),e.setFullViewHeight(r),document.body.style.height=`${r}px`,n};let p=-1,v=null;const H=t=>{const n=(()=>{const e=document.documentElement||document.body,t=e.scrollHeight-e.clientHeight;return t>0?(window.scrollY||e.scrollTop)/t:0})();n!==p&&(t.forEach((t=>((t,n)=>{const r=n*e.getFullViewHeight(),{name:o}=t;if(r===c[o])return;let s=!1;Object.entries(t.styles).forEach((([e,n])=>{for(let o=0;o<n.length;o++){const l=n[o],i=n[o+1],a=f(t,r,e,{from:l,to:i});if(s||(s=m(t,r,{from:l,to:i})),a)break}})),c[o]=r})(t,n))),p=n)},b=t=>{H(t),e.isActive()?(null!==v&&window.cancelAnimationFrame(v),v=window.requestAnimationFrame((()=>b(t)))):null!==v&&(window.cancelAnimationFrame(v),v=null)};let P=null;const x=({listener:e,root:t=document.body})=>{if(!(t instanceof HTMLElement))throw new Error("Invalid root element");n(e),(e=>{e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%"})(t);const r=y();P&&window.removeEventListener("resize",P),P=((e,t)=>{let n=null;return(...r)=>{n&&clearTimeout(n),n=setTimeout((()=>{n=null,e(...r)}),t)}})(y,250),window.addEventListener("resize",P),b(r)},E=()=>{n(),e.setIsActive(!1),e.setFullViewHeight(0),e.setMaxPercentage(0),document.body.style.removeProperty("height"),P&&(window.removeEventListener("resize",P),P=null)};export{E as destroy,x as init};
//# sourceMappingURL=index.js.map
